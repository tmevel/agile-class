<script src="https://cdn.bootcss.com/flv.js/1.5.0/flv.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<video id="videoElement" controls autoplay></video>
<button id="toggleLiveStatusButton" type="button" onclick="toggleLive()"></button>
<select name="lives" id="lives" onchange="changeLive()">
</select>

<script>
    //var host = "localhost";
    var host = "195.14.189.82";

    window.onload = function () {
        $.get("http://"+host+":3000/api/livesList", function (data, status) {
            var htmlStr = "";
            console.log(data.lives);
            for (var i = 0; i < data.lives.length; i++) {
                htmlStr += "<option value=" + data.lives[i][0] + " id=option"+data.lives[i][0]+">" + data.lives[i][0] + " (" + data.lives[i][1] + ")</option>";
            }
            document.getElementById("lives").innerHTML = htmlStr;
            document.getElementById("toggleLiveStatusButton").innerHTML = data.lives[0][1];
        });
    }

    function toggleLive() {
        $.get("http://"+host+":3000/api/toggleLiveStatus?id="+document.getElementById("lives").value, function (data, status) {
            document.getElementById("toggleLiveStatusButton").innerHTML = data.status;
            document.getElementById("option"+document.getElementById("lives").value).innerHTML = document.getElementById("lives").value+" ("+data.status+")";
        });
    }
    function changeLive() {
        playLive(document.getElementById("lives").value);
        $.get("http://"+host+":3000/api/liveStatus?id="+document.getElementById("lives").value, function (data, status) {
            document.getElementById("toggleLiveStatusButton").innerHTML = data.status;
        });
    }
    function playLive(i) {
        if (flvjs.isSupported()) {
            var videoElement = document.getElementById("videoElement");
            var flvPlayer = flvjs.createPlayer({
                type: "flv",
                url: "http://"+host+":8000/live/" + document.getElementById("lives").value + ".flv"
            });
            flvPlayer.attachMediaElement(videoElement);
            flvPlayer.load();
            flvPlayer.play();
        }
    }
</script>